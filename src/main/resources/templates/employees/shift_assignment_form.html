<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>シフト割り当て</title>
    <link rel="stylesheet" th:href="@{/css/style.css}"/>
</head>
<body>
    <h1>シフト割り当て</h1>
    <p th:if="${error}" style="color: red;" th:text="${error}"></p>

    <form th:action="@{/admin/shifts/assign}" method="post">
        <label for="workDate">作業日:</label>
        <input type="date" id="workDate" name="workDate" th:value="${#temporals.format(workDate, 'yyyy-MM-dd')}"/>
        
        <div th:each="workplace, iterStat : ${workplaces}">
            <h2 th:text="${workplace.name}"></h2>
            <input type="hidden" th:name="'assignments[' + ${iterStat.index} + '][workplaceId]'" th:value="${workplace.id}"/>
            
            <div class="time-slot">
                <label>AM:</label>
                <input type="number" th:name="'assignments[' + ${iterStat.index} + '][am][count]'" min="0" value="0"/>
                <label>PM:</label>
                <input type="number" th:name="'assignments[' + ${iterStat.index} + '][pm][count]'" min="0" value="0"/>
            </div>
            
            <div th:if="${workplace.name != '選果'}">
                <h3>タスク（複数選択可）:</h3>
                <div class="task-container">
                    <div class="task-group">
                        <div class="task-subgroup">
                            <div class="task-item" th:each="task : ${firstHouseTasks}">
                                <input type="checkbox" th:name="'assignments[' + ${iterStat.index} + '][tasks][]'" th:value="${task.id}"/>
                                <label th:text="${task.name}"></label>
                            </div>
                        </div>
                        <div class="task-subgroup">
                            <div class="task-item" th:each="task : ${secondHouseTasks}">
                                <input type="checkbox" th:name="'assignments[' + ${iterStat.index} + '][tasks][]'" th:value="${task.id}"/>
                                <label th:text="${task.name}"></label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <p>
            出勤予定人数: AM <span th:text="${employeeCounts.amTotal ?: 0}"></span>, 
            PM <span th:text="${employeeCounts.pmTotal ?: 0}"></span>
        </p>

        <button type="submit">割り当て</button>
    </form>

    <a th:href="@{/admin/menu}">戻る</a>
</body>
</html>