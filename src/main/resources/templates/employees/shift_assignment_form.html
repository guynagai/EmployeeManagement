<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>シフト割り当て</title>
    <style>
        .error {
            color: red;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .section {
            margin-bottom: 10px;
        }
        .task-row {
            margin-bottom: 5px;
        }
        .task-row input[type="checkbox"] {
            margin-right: 5px;
        }
        .task-row label {
            margin-right: 15px;
        }
        .personnel {
            margin-top: 5px;
        }
        .personnel label {
            margin-right: 10px;
        }
        .personnel input[type="number"] {
            width: 60px;
            margin-right: 10px;
        }
        button {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>シフト割り当て</h1>
    <div th:if="${error}" class="error" th:text="${error}"></div>
    <div th:if="${sortingTask == null}" class="error">タスク「選果」が見つかりません。データベースを確認してください。</div>
    <form th:action="@{/admin/shifts/assign}" method="post">
        <div class="section">
            <label>作業日: </label>
            <input type="date" name="workDate" th:value="${workDate.format(T(java.time.format.DateTimeFormatter).ofPattern('yyyy-MM-dd'))}" required />
        </div>

        <div class="section" th:each="workplace : ${workplaces}" th:if="${workplace.name != '選果'}">
            <h2 th:text="${workplace.name}"></h2>
            <div class="task-row" th:with="tasks1=${houseTasks.subList(0, #lists.size(houseTasks) > 5 ? 5 : #lists.size(houseTasks))}">
                <span th:each="task : ${tasks1}">
                    <input type="checkbox" th:id="'task-' + ${workplace.id} + '-' + ${task.id}" th:value="${task.id}" th:name="'assignments[' + ${workplace.id} + '][tasks][]'" />
                    <label th:for="'task-' + ${workplace.id} + '-' + ${task.id}" th:text="${task.name}"></label>
                </span>
            </div>
            <div class="task-row" th:if="${#lists.size(houseTasks) > 5}" th:with="tasks2=${houseTasks.subList(5, #lists.size(houseTasks))}">
                <span th:each="task : ${tasks2}">
                    <input type="checkbox" th:id="'task-' + ${workplace.id} + '-' + ${task.id}" th:value="${task.id}" th:name="'assignments[' + ${workplace.id} + '][tasks][]'" />
                    <label th:for="'task-' + ${workplace.id} + '-' + ${task.id}" th:text="${task.name}"></label>
                </span>
            </div>
            <div class="personnel">
                <label>AM 人数: </label>
                <input type="number" th:name="'assignments[' + ${workplace.id} + '][am][count]'" min="0" value="0" />
                <label>PM 人数: </label>
                <input type="number" th:name="'assignments[' + ${workplace.id} + '][pm][count]'" min="0" value="0" />
            </div>
        </div>

        <div class="section" th:each="workplace : ${workplaces}" th:if="${workplace.name == '選果'}">
            <h2>選果 (固定)</h2>
            <input type="hidden" th:name="'assignments[' + ${workplace.id} + '][tasks][]'" th:value="${sortingTask?.id}" />
            <div class="personnel">
                <label>AM 人数: </label>
                <input type="number" th:name="'assignments[' + ${workplace.id} + '][am][count]'" min="0" value="0" />
                <label>PM 人数: </label>
                <input type="number" th:name="'assignments[' + ${workplace.id} + '][pm][count]'" min="0" value="0" />
            </div>
        </div>

        <button type="submit">割り当て</button>
    </form>

    <a href="/admins">戻る</a>
</body>
</html>